<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MS-200</title>
  <style>
    :root{
      --col-red: #f44336;
      --col-blue: #2196f3;
      --col-green: #4caf50;
      --col-amber: #ffb300;
      --col-purple:#9c27b0;
      --grid-gap: 6px;
      --cell-radius: 12px;
      --cell-pad: 8px 6px;
      --cell-h: 64px;
      --font: -apple-system, BlinkMacSystemFont, "Hiragino Kaku Gothic ProN",
      "Noto Sans JP", "Meiryo", "Segoe UI", system-ui, sans-serif;
    }
    * { box-sizing: border-box; }
    html, body{
      height: 100%;
      -webkit-text-size-adjust: 100%;
    }
    body{
      margin: 14px;
      font-family: var(--font);
      color: #222;
      background: #fafafa;
      -webkit-user-select: none; /* é•·æŠ¼ã—é¸æŠã®æŠ‘æ­¢ */
      -webkit-touch-callout: none; /* iOSã®é•·æŠ¼ã—ãƒ¡ãƒ‹ãƒ¥ãƒ¼æŠ‘æ­¢ */
    }
    h1{
      font-size: 1.15rem;
      margin: 0 0 8px 0;
    }
    .desc{
      color: #555;
      margin-bottom: 10px;
      font-size: .95rem;
      line-height: 1.5;
    }
    .toolbar{
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      padding: 10px 12px;
      background: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 12px;
      margin-bottom: 12px;
    }
    .row{
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .palette{
      display: inline-flex;
      gap: 10px;
      align-items: center;
    }
    .swatch{
      width: 34px;
      height: 34px;
      border-radius: 50%;
      border: 2px solid #fff;
      box-shadow: 0 0 0 2px rgba(0,0,0,.08);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      outline: none;
      touch-action: manipulation;
    }
    .swatch[aria-checked="true"]{
      box-shadow: 0 0 0 2px #222;
    }
    .swatch .check{
      display: none;
      color: #fff;
      font-size: 16px;
      font-weight: 700;
      text-shadow: 0 1px 2px rgba(0,0,0,.35);
    }
    .swatch[aria-checked="true"] .check{
      display: block;
    }
    .namebox{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      width: 100%;
    }
    .namebox input{
      flex: 1 1 auto;
      padding: 10px 12px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid #ddd;
      background: #fff;
    }
    .status{
      color: #333;
      font-size: .95rem;
    }
    .status .chip{
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #2a2a6a;
      border: 1px solid #dbe1ff;
    }
    .grid-2{
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 900px){
      .grid-2{ grid-template-columns: 1fr 1fr; }
    }
    .month{
      background: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 12px;
      padding: 8px;
    }
    .month-header{
      display: flex;
      align-items: baseline;
      gap: 8px;
      padding: 6px 6px 8px;
      border-bottom: 1px solid #eee;
      margin-bottom: 6px;
    }
    .month-title{
      font-size: 1.05rem;
      font-weight: 700;
    }
    .legend{
      margin-left: auto;
      color: #777;
      font-size: .9rem;
    }
    .cal{
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: var(--grid-gap);
      padding: 6px;
      touch-action: none; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚ˆã‚Šãƒ‰ãƒ©ãƒƒã‚°å„ªå…ˆ */
    }
    .dow{
      text-align: center;
      color: #000; /* æ–‡å­—ã‚’é»’ã« */
      font-weight: 700;
      font-size: .9rem;
      padding: 6px 0;
    }
    /* é€±æœ«ã®ç‰¹åˆ¥è‰²ã¯ä½¿ã‚ãªã„ï¼ˆé»’ã«çµ±ä¸€ï¼‰ */
    .cell{
      height: var(--cell-h);
      background: #fff;
      border: 1px solid #e6e6e6;
      border-radius: var(--cell-radius);
      padding: var(--cell-pad);
      display: flex;
      align-items: flex-start;
      justify-content: flex-end;
      position: relative;
      cursor: pointer;
      user-select: none;
      transition: transform .02s ease-in-out, box-shadow .12s ease-in-out;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      color: #000; /* ã‚»ãƒ«å†…æ–‡å­—ã‚‚é»’ */
    }
    .cell:hover{ box-shadow: 0 1px 4px rgba(0,0,0,.06); }
    .cell:active{ transform: scale(.995); }
    .cell.is-today{
      outline: 2px solid #14a44d;
      outline-offset: -2px;
    }
    .cell.disabled{
      visibility: hidden;
      pointer-events: none;
    }
    .date-num{
      font-weight: 700;
      font-size: .95rem;
      color: #000; /* é»’ */
      position: absolute;
      top: 6px;
      right: 8px;
      line-height: 1;
    }
    .label{
      position: absolute;
      left: 8px;
      bottom: 6px;
      padding: 2px 6px;
      border-radius: 8px;
      background: rgba(255,255,255,.85);
      color: #000; /* é»’ */
      font-size: 12px;
      max-width: calc(100% - 16px);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: none; /* æœªè¨­å®šæ™‚ã¯éè¡¨ç¤º */
    }
    /* è‰²ãŒå¡—ã‚‰ã‚ŒãŸã‚»ãƒ«ã§ã‚‚æ–‡å­—ã¯é»’ã®ã¾ã¾ */
    .cell[data-color]{
      border-color: transparent;
    }
    .cell[data-name] .label{
      display: inline-block;
    }
    /* é€±æœ«ï¼ˆæ’é™¤ï¼šé¸æŠä¸å¯ï¼‰ */
    .cell.wkend{
      background: #f5f5f5;
      color: #999;
      border-style: dashed;
      cursor: not-allowed;
      pointer-events: none; /* ã‚¿ãƒƒãƒ—ç„¡åŠ¹ */
    }
    .cell.wkend .date-num{ color: #999; }

	#saveBtn {
	padding: 20px 24px;   /* ç¸¦æ¨ª ç´„2å€ */
	font-size: 1.3rem;    /* æ–‡å­—ã‚‚å¤§ãã */
	border-radius: 16px;
	}

  </style>
</head>
<body>
  <h1>MS-200</h1>
    <div class="toolbar" role="group" aria-label="æ“ä½œ">
    <div class="row">
      <strong>è‰²ï¼š</strong>
      <div class="palette" id="palette" role="radiogroup" aria-label="åŸºæº–è‰²ã‹ã‚‰é¸æŠ">
        <button class="swatch" role="radio" aria-checked="true" title="èµ¤"
          data-color="var(--col-red)" style="background: var(--col-red)"><span class="check">âœ“</span></button>
        <button class="swatch" role="radio" aria-checked="false" title="é’"
          data-color="var(--col-blue)" style="background: var(--col-blue)"><span class="check">âœ“</span></button>
        <button class="swatch" role="radio" aria-checked="false" title="ç·‘"
          data-color="var(--col-green)" style="background: var(--col-green)"><span class="check">âœ“</span></button>
        <button class="swatch" role="radio" aria-checked="false" title="é»„"
          data-color="var(--col-amber)" style="background: var(--col-amber)"><span class="check">âœ“</span></button>
        <button class="swatch" role="radio" aria-checked="false" title="ç´«"
          data-color="var(--col-purple)" style="background: var(--col-purple)"><span class="check">âœ“</span></button>
      </div>
    </div>
    <div class="row namebox">
      <label for="nameInput" style="font-weight:600;">åå‰ï¼š</label>
      <input id="nameInput" type="text" placeholder="ä¾‹ï¼šå±±ç”°" inputmode="text" />
      <button id="saveBtn" type="button" style="margin-left:auto;" aria-label="å…¥åŠ›å†…å®¹ã‚’ä¿å­˜">ğŸ’¾ ä¿å­˜</button>
    </div>
    <div class="row">
      <div class="status" id="status"><span class="chip">æ“ä½œï¼š</span></div>
    </div>
  </div>
    <ul>
      <li><strong>ã‚¿ãƒƒãƒ—</strong>ï¼šæœªå¡—ã‚Šâ†’è‰²ä»˜ã‘/å†åº¦ã‚¿ãƒƒãƒ—ã§æ¶ˆå»</li>
      <li><strong>ç”»é¢ã‚’é–‰ã˜ã‚‹å‰ã«ä¿å­˜ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™</li>	
    </ul>
  <div class="grid-2" id="calWrap">
    <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒJSã§æŒ¿å…¥ã•ã‚Œã¾ã™ -->
  </div>
  <div class="desc" style="color:#666; margin-top:10px;">
  </div>
  <script>
    // ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ======
    const fmtDate = (d) => {
      const y = d.getFullYear();
      const m = (d.getMonth()+1).toString().padStart(2,'0');
      const day = d.getDate().toString().padStart(2,'0');
      return `${y}-${m}-${day}`;
    };
    // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼
    const STORAGE_KEY = 'shared-tools-calendar-v2';

    // ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆã®åˆæœŸè‰²
    let currentColor = getComputedStyle(document.documentElement).getPropertyValue('--col-red').trim();
    const paletteEl = document.getElementById('palette');
    paletteEl.addEventListener('click', (e)=>{
      const btn = e.target.closest('.swatch');
      if(!btn) return;
      [...paletteEl.querySelectorAll('.swatch')].forEach(b=>b.setAttribute('aria-checked','false'));
      btn.setAttribute('aria-checked','true');
      currentColor = btn.dataset.color;
    });

    const nameInput = document.getElementById('nameInput');

    // ====== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”Ÿæˆ ======
    const calWrap = document.getElementById('calWrap');
    const dateCellMap = new Map(); // "YYYY-MM-DD" -> cell element
    const todayStr = fmtDate(new Date());

    const buildMonth = (year, monthIndex) => {
      const monthContainer = document.createElement('section');
      monthContainer.className = 'month';

      const header = document.createElement('div');
      header.className = 'month-header';
      const title = document.createElement('div');
      title.className = 'month-title';
      title.textContent = `${year}å¹´${monthIndex+1}æœˆ`;
      const legend = document.createElement('div');
      legend.className = 'legend';
      legend.textContent = '';
      header.appendChild(title);
      header.appendChild(legend);

      const cal = document.createElement('div');
      cal.className = 'cal';

      const dows = ['æœˆ','ç«','æ°´','æœ¨','é‡‘'];
      dows.forEach((w) =>{
        const dow = document.createElement('div');
        dow.className = 'dow';
        dow.textContent = w;
        cal.appendChild(dow);
      });

      const first = new Date(year, monthIndex, 1);
const daysInMonth = new Date(year, monthIndex+1, 0).getDate();
// Weekday index helper: Mon=0..Fri=4, Sat/Sun return -1
const getWIdx = (dow) => (dow>=1 && dow<=5) ? (dow-1) : -1;
// Add weekday headers
// (already added above via dows)
// Leading empties before the first weekday
let firstWeekdayIdx = -1;
for(let d=1; d<=7; d++){
  const dow = new Date(year, monthIndex, d).getDay();
  const wi = getWIdx(dow);
  if(wi !== -1){ firstWeekdayIdx = wi; break; }
}
for(let i=0; i<firstWeekdayIdx; i++){
  const empty = document.createElement('div');
  empty.className = 'cell disabled';
  cal.appendChild(empty);
}
// Generate only Mon-Fri cells
for(let d=1; d<=daysInMonth; d++){
  const dateObj = new Date(year, monthIndex, d);
  const dow = dateObj.getDay();
  const wi = getWIdx(dow);
  if(wi === -1) continue; // skip weekends entirely
  const cell = document.createElement('button');
  cell.type = 'button';
  cell.className = 'cell';
  const dateStr = fmtDate(dateObj);
  cell.dataset.date = dateStr;
  cell.setAttribute('aria-label', `${dateStr}`);
  cell.setAttribute('data-color', '');
  const num = document.createElement('div');
  num.className = 'date-num';
  num.textContent = d;
  cell.appendChild(num);
  const label = document.createElement('div');
  label.className = 'label';
  label.textContent = '';
  cell.appendChild(label);
  if(dateStr === todayStr){
    cell.classList.add('is-today');
    cell.title = 'ä»Šæ—¥';
  }
  // click to toggle
  cell.addEventListener('click', onCellClick);
  cal.appendChild(cell);
  dateCellMap.set(dateStr, cell);
}
monthContainer.appendChild(header);
      monthContainer.appendChild(cal);
      return monthContainer;
    };

    // ä»Šæœˆï¼‹æ¬¡æœˆ
    const now = new Date();
    const y = now.getFullYear();
    const m = now.getMonth();
    const nextY = (m === 11) ? y+1 : y;
    const nextM = (m + 1) % 12;
    calWrap.appendChild(buildMonth(y, m));
    calWrap.appendChild(buildMonth(nextY, nextM));

    // ====== å˜ã‚¿ãƒƒãƒ—ï¼ˆãƒˆã‚°ãƒ«ï¼šå¡—ã‚‹ï¼æ¶ˆã™ï¼‰ ======
    function onCellClick(e){
      const cell = e.currentTarget;
      const painted = !!cell.getAttribute('data-color');
      if(painted){
        eraseCell(cell);
      }else{
        paintCell(cell, currentColor, nameInput.value.trim());
      }
    }

    function paintCell(cell, color, name){
      cell.style.background = color;
      cell.setAttribute('data-color', color);
      if(name){
        cell.setAttribute('data-name', name);
        const label = cell.querySelector('.label');
        if(label){
          label.textContent = name;
          label.title = name;
        }
      }else{
        cell.removeAttribute('data-name');
        const label = cell.querySelector('.label');
        if(label){
          label.textContent = '';
          label.removeAttribute('title');
        }
      }
    }

    function eraseCell(cell){
      cell.style.background = '';
      cell.setAttribute('data-color','');
      cell.removeAttribute('data-name');
      const label = cell.querySelector('.label');
      if(label){
        label.textContent = '';
        label.removeAttribute('title');
      }
    }

    // ====== ãƒ‰ãƒ©ãƒƒã‚°ç„¡åŠ¹ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ã—ãªã„ï¼‰ ======

    // ====== ä¿å­˜ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰ ======
    function collectState(){
      const painted = [];
      for(const [date, cell] of dateCellMap.entries()){
        
                const color = cell.getAttribute('data-color');
        if(color){
          painted.push({date, color, name: cell.getAttribute('data-name') || ''});
        }
      }
      return {
        name: nameInput.value || '',
        painted
      };
    }

    function applyState(state){
      nameInput.value = state?.name || '';
      if(Array.isArray(state?.painted)){
        state.painted.forEach(({date, color, name})=>{
          const cell = dateCellMap.get(date);
          if(cell){
            paintCell(cell, color, name || '');
          }
        });
      }
    }

    function save(){
      const state = collectState();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      flashStatus('ä¿å­˜ã—ã¾ã—ãŸ');
    }

    function load(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      try{
        const state = JSON.parse(raw);
        applyState(state);
        flashStatus('ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
      }catch(e){
        console.warn('load failed', e);
      }
    }

    function flashStatus(msg){
      const st = document.getElementById('status');
      const b = document.createElement('span');
      b.className = 'chip';
      b.textContent = msg;
      st.appendChild(b);
      setTimeout(()=>{ b.remove(); }, 1800);
    }

    document.getElementById('saveBtn').addEventListener('click', save);

    // åˆæœŸèª­è¾¼
    load();
  </script>
</body>
</html>
